<odoo>

    <record id="view_pharmacy_prescription_form" model="ir.ui.view">
        <field name="name">pharmacy.prescription.form</field>
        <field name="model">medical.pharmacy</field>
        <field name="arch" type="xml">
            <form string="Pharmacy Prescription Form" class="o_sale_order">
                <header>
                    <field name="state" select="2" widget="statusbar" class="oe_highlight"
                           statusbar_visible="draft,sale,invoiced,paid"/>
                    <field name="re_state" invisible="1"/>
                    <button name="create_work_order" string="Create Invoice" type='object' class="btn-primary"
                            attrs="{'invisible':[('state','not in',('draft')),('re_state','in',('done'))]}"/>
                    <button name="print_invoice" string="Print Invoice" type='object' class="btn-primary"
                            attrs="{'invisible':[('state','not in',('paid'))]}"/>
                    <button name="credit_note_pharmacy" string="Credit Note" icon="fa-plus-square" type="object"
                            attrs="{'invisible':['|',('state','not in',('paid')),('is_refunded','=',True)]}"
                            class="btn-default"
                            confirm="Are you sure to create credit note?"/>
                    <button name="print_prescription" type="object" string="Print Prescription" class="btn-primary"/>
                </header>
                <h3>
                    <field name="sequence" readonly="1"/>
                    <div class="oe_button_box" name="button_box">
                        <button type="object"
                                name="picking_error"
                                class="oe_stat_button"
                                icon="fa-warning" attrs="{'invisible':[('picking_count','=',0)]}">
                            <field name="picking_count" widget="statinfo" string="Picking Error" style="color:#B10707;"
                                   help="Please Check Pickings "/>
                        </button>
                        <button name="action_view_invoice" type="object" class="oe_stat_button"
                                icon="fa-pencil-square-o" attrs="{'invisible': [('invoice_count', '=', 0)]}">
                            <field name="invoice_count" widget="statinfo" string="Invoices"/>
                        </button>
                    </div>
                </h3>
                <div class="row">
                    <h4>
                        <div class="col-xs-8" style="color:#B10707;text-align:left;font-size:15px;font-weight: bold">
                            <div class="col-xs-2" attrs="{'invisible': [('final_total', '=', 0)]}">
                                <span>Total&#160;&#160;</span>
                                <br/>
                                <field name="final_total"/>
                                <span>&#160;₹</span>
                            </div>
                            <div class="col-xs-3" attrs="{'invisible': [('final_total', '=', 0)]}">
                                <span>Paid&#160;&#160;</span>
                                <br/>
                                <field name="paid_amount"/>
                                <span>&#160;₹</span>
                            </div>
                            <div class="col-xs-3" attrs="{'invisible': [('paid_amount', '=', 0)]}">
                                <span>Balance&#160;&#160;</span>
                                <br/>
                                <field name="balance_amount"/>
                                <span>&#160;₹</span>
                            </div>
                        </div>
                        <div class="col-xs-4" style="color:#0077b3;text-align:left;font-size:13px;">
                            <group>
                                <field name="referred_by_id"
                                       attrs="{'readonly':['|',('state','not in','draft'),('re_state','not in',('draft'))]}"/>
                                <field name="reference_type_id"
                                       attrs="{'readonly':['|',('state','not in','draft'),('re_state','not in',('draft'))]}"/>
                                <field name="name" readonly="1" style="color:#B75A7B" nolabel="1"/>
                            </group>
                        </div>
                    </h4>
                </div>
                <group string="Patient Information" col="3">
                    <group style="width:35%">
                         <field name="is_refunded" invisible="1"/>
                        <field name="new_patient_is"
                               attrs="{'readonly':['|',('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                        <h2>
                            <field name="patient_id" style="width:130%;" options="{'no_create_edit': True}"
                                   placeholder="Patient Name"
                                   attrs="{'readonly': ['|',('state', 'not in', ('draft')),('re_state','not in',('draft'))],'invisible':[('new_patient_is','=',True),('state','=','draft')],'required':[('new_patient_is','=',False)]}"/>
                            <field name="patient_new" style="width:130%;" placeholder="New Patient"
                                   attrs="{'readonly': ['|',('state', 'not in', ('draft')),('re_state','not in',('draft'))],'invisible':['|','|',('new_patient_is','=',False),('state','!=','draft'),('re_state','not in',('draft'))],'required':[('new_patient_is','=',True)]}"/>
                        </h2>
                        <field name="street"
                               placeholder="Address..."
                               attrs="{'readonly':['|',('state','not in',('draft')),('re_state','not in',('draft'))]}"
                               class="o_address_street"

                        />
                        <field name="street2"
                               placeholder="Street 2..."
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"
                               class="o_address_street" invisible="1"


                        />
                        <field name="city"
                               placeholder="Place"
                               class="o_address_city"
                               attrs="{'readonly':['|',('state','not in',('draft')),('re_state','not in',('draft'))]}"
                        />
                        <field name="state_id"
                               class="o_address_state"
                               placeholder="State"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"
                               options='{"no_open": True,"no_create_edit": True,"no_quick_create":True}'
                               context="{'country_id': country_id, 'zip': zip}" invisible="1"
                        />

                        <field name="zip"
                               placeholder="ZIP"
                               class="o_address_zip" invisible="1"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"
                        />
                        <field name="country_id"
                               placeholder="Country"
                               class="o_address_country" invisible="1"
                               options='{"no_open": True, "no_create": True}'
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"
                        />
                        <field name="phone"
                               placeholder="Contact Number"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                    </group>
                    <group style="width:32.5%">
                        <div style="height:84px">
                        </div>
                        <field name="date"
                               placeholder="Admission Date"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                        <field name="age"
                               placeholder="Age"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                        <field name="gender"
                               placeholder="Gender"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                    </group>
                    <group style="width:32.5%">
                        <field name="search_file_number" style="background:lightgrey;color: Red;"
                               placeholder="Search File Number" nolabel="1"
                               attrs="{'invisible':['|',('new_patient_is','=',True),('state','!=','draft')]}"/>
                        <div style="height:80px">
                        </div>
                        <field name="identification_code"
                               placeholder="File Number"
                               readonly="1" force_save="1" store="1"/>
                        <field name="doctor_id" options='{"no_create_edit": True,"no_open": True}' placeholder="Doctor"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                        <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"
                               placeholder="Tags"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                        <field name="treatment_status" invisible="1"/>
                    </group>
                </group>
                <group>
                    <div>
                        <label for="pharmacy_details_ids" string="Pharmacy"
                               style="color:#B10707;text-decoration:underline;text-align:center;font-size:14px;width:90%;font-weight: bold;"/>
                        <field name="pharmacy_details_ids" nolabel="1" mode='tree' style="width:97%"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft','processed'))]}">
                            <tree string="Pharmacy details" editable="bottom">
                                <field name="code"/>
                                <field name="product_id" options='{"no_open": True, "no_create": True}' required="1"/>
                                <field name="lot_number_id" force_save="1" style="width:100%" widget="selection"/>
                                <field name="qty_available" force_save="1" readonly="1"/>
                                <field name="quantity" force_save="1"/>
                                <field name="price_unit" force_save="1"/>
                                <field name="tax_ids" widget='many2many_tags'/>
                                <field name="discount" force_save="1" invisible="1"/>
                                <field name="price_tax" force_save="1" invisible="1"/>
                                <field name="sub_total" force_save="1"/>
                            </tree>
                        </field>
                    </div>
                </group>
                <group col="2">
                    <label for="medicine_ids" string="Medications"
                           style="color:#B10707;text-align:center;font-size:13px;font-weight: bold"
                           attrs="{'invisible':[('treatment_status', '=', False)]}"/>
                    <group style="width:50%">
                        <div>
                            <field name="medicine_ids" attrs="{'invisible':[('treatment_status', '=', False)]}">
                                <tree edit="0" create="0">
                                    <field name="product_id"/>
                                    <field name="eye"/>
                                    <field name="stock"/>
                                    <field name="frequency" invisible="1"/>
                                    <field name="frequency_id"/>
                                    <field name="days"/>
                                </tree>
                            </field>
                            <group>
                                <field name="doctor_prescription"
                                       attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft'))]}"/>
                            </group>
                        </div>
                    </group>
                    <group style="width:10%">
                    </group>
                    <group style="width:30%"
                           attrs="{'readonly':[('state','not in','draft'),('re_state','not in','draft')]}">
                        <label for="total_amount"/>
                        <div class="o_row">
                            <field name="total_amount" style="width:50%" widget='monetary'/>
                            <span>&#160;₹</span>
                        </div>
                        <field name="discount_type" widget='radio' options="{'horizontal': true}"
                               attrs="{'readonly':[('state','not in',('draft')),('re_state','not in',('draft','processed'))]}"/>
                        <field name="discount" widget='monetary'
                               attrs="{'invisible':[('discount_type','=',False)],'readonly':[('state','not in','draft'),('re_state','not in',('draft','processed'))]}"/>
                        <label for="tax_amount"/>
                        <div class="o_row">
                            <field name="tax_amount" readonly="1"/>
                            <span>&#160;₹</span>
                        </div>

                        <label for="final_total"/>
                        <div class="o_row">
                            <field name="final_total" widget='monetary' options="{'currency_field': 'currency_id'}"
                                   readonly="1"/>
                            <span>&#160;₹</span>
                        </div>
                    </group>
                </group>
            </form>
        </field>
    </record>
    <record id="view_prescription_pharmacy_tree" model="ir.ui.view">
        <field name="name">Pharmacy Tree</field>
        <field name="model">medical.pharmacy</field>
        <field name="arch" type="xml">
            <tree string="Optics" decoration-bf="re_state=='done'">
                <field name="sequence"/>
                <field name="patient_id"/>
                <field name="identification_code"/>
                <field name="doctor_id"/>
                <field name="referred_by_id"/>
                <field name="reference_type_id"/>
                <field name="tag_ids" widget="many2many_tags"/>
                <field name="date"/>
                <field name="state"/>
                <field name="picking_count"/>
                <field name="re_state" invisible="1"/>
            </tree>
        </field>
    </record>
    <record id="optics_search_view" model="ir.ui.view">
        <field name="name">medical.pharmacy.search</field>
        <field name="model">medical.pharmacy</field>
        <field name="arch" type="xml">
            <search string="Pharmacy">
                <field name="identification_code" string="File Number"/>
                <field name="date" string="Date"/>
                <field name="patient_id" string="Patient"/>
                <field name="phone" string="Phone Number"/>
                <field name="doctor_id" string="Doctor"/>
                <field name="state" string="State"/>
                <field name="new_patient_is" string="New Patient"/>
                <separator/>
                <filter string="Today" name="date_today"
                        domain="[('date_today', '=', context_today().strftime('%Y-%m-%d'))]"/>
            </search>
        </field>
    </record>
    <record id="action_pharmacy_prescription" model="ir.actions.act_window">
        <field name="name">Pharmacy Prescription Report</field>
        <field name="res_model">medical.pharmacy</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'create': True,'search_default_date_today':'date_today'}</field>
        <field name="domain"></field>
    </record>
    <record id="action_pharmacy_prescription_tree1_view1" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_prescription_pharmacy_tree"/>
        <field name="act_window_id" ref="action_pharmacy_prescription"/>
    </record>
    <record id="action_pharmacy_prescription_tree1_view2" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_pharmacy_prescription_form"/>
        <field name="act_window_id" ref="action_pharmacy_prescription"/>
    </record>

    <menuitem id="pharmacy_main" groups="medical_opthalmology.group_pharmacy_access" name="Pharmacy"
              parent="medical_opthalmology.patient_revisit_root" sequence="2"/>
    <menuitem id="sale_orders" action="action_pharmacy_prescription" parent="pharmacy_main"
              sequence="1"/>
</odoo>

